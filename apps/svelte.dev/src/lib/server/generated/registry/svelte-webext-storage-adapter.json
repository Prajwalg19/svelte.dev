{
	"name": "svelte-webext-storage-adapter",
	"description": "Create Svelte stores backed by chrome.storage for WebExtensions.",
	"repo_url": "https://github.com/PixievoltNo1/svelte-webext-storage-adapter",
	"authors": ["pixievoltno1"],
	"homepage": "https://github.com/PixievoltNo1/svelte-webext-storage-adapter",
	"downloads": 35,
	"updated": "2024-04-04T04:39:11.213Z",
	"tags": ["miscellaneous"],
	"github_stars": 25,
	"typescript": false,
	"version": "3.0.2",
	"svelte_range": "^3.0.0 || ^4.0.0-next.1 || ^5.0.0-next.94",
	"last_rune_check_version": "3.0.2",
	"dependency_tree": {
		"rootIndex": 0,
		"packages": [
			{
				"name": "svelte-webext-storage-adapter",
				"version": "3.0.2",
				"size": 24517
			}
		],
		"dependencies": [],
		"circular": []
	},
	"readme": "# `svelte-webext-storage-adapter`\n[![npm](https://img.shields.io/npm/v/svelte-webext-storage-adapter.svg)](https://www.npmjs.com/package/svelte-webext-storage-adapter)\n[![Bundle size](https://img.shields.io/bundlephobia/minzip/svelte-webext-storage-adapter.svg)](https://bundlephobia.com/result?p=svelte-webext-storage-adapter)\n[![GitHub CI Status](https://img.shields.io/github/actions/workflow/status/PixievoltNo1/svelte-webext-storage-adapter/node.js.yml?branch=master&label=tests)](https://github.com/PixievoltNo1/svelte-webext-storage-adapter/actions/workflows/node.js.yml)\n[![License](https://img.shields.io/github/license/PixievoltNo1/svelte-webext-storage-adapter.svg)](https://github.com/PixievoltNo1/svelte-webext-storage-adapter/blob/master/LICENSE.txt)\n[![GitHub Repo stars](https://img.shields.io/github/stars/PixievoltNo1/svelte-webext-storage-adapter?style=social)](https://github.com/PixievoltNo1/svelte-webext-storage-adapter)\n\nIf you're using [Svelte](https://svelte.dev/) v3 or v4 to make a [WebExtension](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions) for Firefox or Chrome, you can use this to create [writable stores](https://svelte.dev/tutorial/writable-stores) that are backed by your extension's storage. Handy features are provided to you right out of the box:\n\n* **Flexible:** This package can work with a part of or the entirety of any area of `chrome.storage`, including areas from 3rd-party packages.\n* **Automatic batching:** Save on storage writes when all your store changes are batched up to be sent out at the next Svelte tick.\n* **Live updates:** If you'd like, this package will handle listening for storage changes for you, even in 3rd-party area (with their support).\n\nThis project has a [Code of Conduct](CODE_OF_CONDUCT.md). By participating in the Git repo or issues tracker, you agree to be as courteous, welcoming, and generally a lovely person as its terms require. üòä\n\n<!-- Table of contents generated mostly by the markdown-toc package - however, it includes emoji in the URLs, and they need to be stripped for GitHub -->\n<!-- toc -->\n\n  * [Default export: `webextStorageAdapter()`](#default-export-webextstorageadapter)\n    + [Parameter: `storageArea`](#parameter-storagearea)\n    + [Parameter: `keys`](#parameter-keys)\n    + [Parameter: `options`](#parameter-options)\n      - [`live`](#live)\n  * [Store groups](#store-groups)\n    + [Property: `stores`](#property-stores)\n    + [Property: `ready`](#property-ready)\n    + [Property: `onWrite()`](#property-onwrite)\n    + [Handling write errors with `unhandledrejection`](#handling-write-errors-with-unhandledrejection)\n    + [Property: `unLive()`](#property-unlive)\n    + [Methods don't use `this`](#methods-dont-use-this)\n  * [Implementation requirements for `StorageArea`](#implementation-requirements-for-storagearea)\n  * [Tip: Use with `svelte-writable-derived`](#tip-use-with-svelte-writable-derived)\n  * [Browser compatibility](#browser-compatibility)\n- [üíñ Support the developer](#-support-the-developer)\n  * [üí∏ ... with money](#--with-money)\n  * [üíå ... with kind words](#--with-kind-words)\n  * [ü§ù ... with a job](#--with-a-job)\n\n<!-- tocstop -->\n\n## Default export: `webextStorageAdapter()`\n\n<i>Parameters: [`storageArea`](#parameter-storagearea) (string or `StorageArea`), [`keys`](#parameter-keys) (string, array, object, or `null`), optional [`options`](#parameter-options) (object)</i><br>\n<i>Returns a [store group](#store-groups)</i>\n\nCreates a group of Svelte v3 [writable stores](https://svelte.dev/tutorial/writable-stores), populated from & persisted to `chrome.storage`. It will immediately request the needed values; this is asynchronous, but the store group will be returned synchronously with all stores in place. You can use [the store group's `ready` promise](#property-ready) to determine when values from storage are available.\n\n```javascript\n// Example\n\nimport webextStorageAdapter from \"svelte-webext-storage-adapter\";\nvar storeGroup = webextStorageAdapter(\"sync\", [\"thisKey\", \"thatKey\"]);\nstoreGroup.ready.then( () => {\n\t// You can now interact with data in storage\n} );\n```\n\n### Parameter: `storageArea`\n\n<i>string or [`StorageArea`](https://developer.chrome.com/extensions/storage#type-StorageArea)</i>\n\nThe object that will be read from and written to. If it's a string, it's used to look up the object from `chrome.storage`. Objects from outside `chrome.storage` may be used if they meet the [implementation requirements](#implementation-requirements-for-storagearea).\n\n```javascript\n// Example: These are equivalent\nvar group1 = webextStorageAdapter(chrome.storage.local, null);\nvar group2 = webextStorageAdapter(\"local\", null);\n```\n\n### Parameter: `keys`\n\n<i>string, array, object, or `null`</i>\n\nThis can be any of the same values accepted by [`StorageArea.get`](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/storage/StorageArea/get). Using `null` will allow the store group to read and write any key in storage. Unlike `StorageArea.get`, default values specified in the object form will survive the round trip regardless of type.\n\n```javascript\n// Example: Specifying keys with default values\nvar storeGroup = webextStorageAdapter(\"sync\", {\n\ti: \"he\",\n\tyou: \"me\",\n\twe: \"all together\",\n});\nstoreGroup.stores.we.subscribe(console.log); // logs \"all together\"\n```\n\n### Parameter: `options`\n\n<i>object</i>\n\nThis parameter and all its properties are optional. There is currently only one option; more may be added later.\n\n#### `live`\n\n<i>boolean</i><br>\n<i>Default: `true`</i>\n\nIf `true`, `webextStorageAdapter` will listen for changes to `storageArea` and propagate them to the stores. If a key is deleted from storage, this will set the key's corresponding store to its default value if one was specified in the `keys` parameter, or `undefined` otherwise.\n\nThis will prevent the store group from being garbage-collected. If this is a concern, you can call the group's [`unLive` method](#property-unlive) when you're done with it.\n\nThis throws an error if used with a 3rd-party area that doesn't support it.\n\n```javascript\n// Example\n\n// In your extension's tab page / browser action popup / etc.\nimport webextStorageAdapter from \"svelte-webext-storage-adapter\";\n// The live option defaults to true, but we explicitly set it here for demonstration purposes\nvar storeGroup = webextStorageAdapter(\"sync\", \"noise\", {live: true});\nstoreGroup.stores.noise.subscribe( (value) => console.log(value) );\nchrome.runtime.sendMessage(\"Sound the alarm!\");\n\n// In your extension's background page\nchrome.runtime.onMessage.addListener( (message) => {\n\tif (message == \"Sound the alarm!\") {\n\t\tchrome.storage.sync.set({noise: \"awooga\"}); // The above script will eventually log \"awooga\"\n\t}\n} );\n```\n\n## Store groups\n\n<i>Object</i>\n\nStore groups are returned synchronously from [`webextStorageAdapter`](#default-export-webextstorageadapter).\n\n### Property: `stores`\n\n<i>Object (prototype: `null`)</i>\n\nThis has a property for every key specified in [`keys`](#parameter-keys), and each property's value is a Svelte writable store containing the corresponding value in [`storageArea`](#parameter-storagearea). If `keys` was `null`, then `stores` is a `Proxy` that allows getting *any* property to obtain a usable store, but operations such as `Object.keys()`, `for...in`, etc. will only expose keys that are known to have values.\n\nNew values introduced via the stores' `set` and `update` methods are batched up into a single `storageArea.set()` call that happens when [Svelte's `tick()`](https://svelte.dev/docs#tick) resolves. The stores themselves will have their new values immediately.\n\nTo help avoid bugs in your code, directly setting any property of `stores` is disallowed, and will throw an error in strict mode. Remember to use `stores.example.set(value)` instead of `stores.example = value`!\n\n```javascript\n// Example\n\nimport webextStorageAdapter from \"svelte-webext-storage-adapter\";\nvar storeGroup = webextStorageAdapter(\"sync\", null);\n// Since storeGroup.ready hasn't resolved yet, no data will be loaded...\nconsole.log( Object.keys(storeGroup.stores) ); // []\n// ... but we can set data and have it sent to extension storage anyways\nstoreGroup.stores.tooBad.set(\"Waluigi time\");\nconsole.log( Object.keys(storeGroup.stores) ); // [\"tooBad\"]\n\n// For non-null keys parameters, the specified keys are always present\nvar storeGroup2 = webextStorageAdapter(\"sync\", [\"thing1\", \"thing2\"]);\nconsole.log( Object.keys(storeGroup2.stores) ); // [\"thing1\", \"thing2\"]\n```\n\n### Property: `ready`\n\n<i>`Promise`</i>\n\nResolves with `true` after all stores have been set to values received from the initial `storageArea.get` call, or rejects with a reported error object.\n\n```javascript\n// Example\n\n// In a Svelte component's <script> block\nimport webextStorageAdapter from \"svelte-webext-storage-adapter\";\nvar { stores, ready, unLive } = webextStorageAdapter(\"sync\", null);\nvar preparations = Promise.all([ready, ...otherAsyncWork]);\n```\n```html\n<!-- In the same component's markup -->\n{#await preparations}\n\t<LoadingAnimation/>\n{:then}\n\t<UsefulContent/>\n{/await}\n```\n\n### Property: `onWrite()`\n\n<i>Parameter: `subscriber` (function with signature `(write, setItems)`)</i><br>\n<i>Returns a function</i>\n\nFunctions passed to this method are subscribed to be called when data starts getting written to storage. The return value can be called to unsubscribe the subscriber. Subscribers are called with two parameters:\n\n- `write` is a `Promise` that resolves with `true` when the write is finished, or rejects with an object if there's an error. The rejection object has properties `error` with the error reported from `chrome.runtime.lastError`, and `setItems` which is the same as below.\n- `setItems` is an object of key/value pairs, the same one passed to [`storageArea.set`](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/storage/StorageArea/set).\n\n```javascript\n// Example: Save indicator\n/* Save indicators usually aren't needed for WebExtensions, as you're typically\nsaving small amounts of data to a local device. */\n\n// In a Svelte component's <script> block\nimport { onDestroy } from \"svelte\";\nvar activeWriteCount = 0;\nvar unsubscribe = storeGroup.onWrite( (write) => {\n\tactiveWriteCount += 1;\n\twrite.finally( () => { activeWriteCount -= 1; } );\n} );\nonDestroy(unsubscribe);\n```\n```html\n<!-- In the same component's markup -->\n{#if activeWriteCount}\n\t<Throbber/>\n{/if}\n```\n\n### Handling write errors with `unhandledrejection`\n\nThe `write` promise described above is created whether or not `onWrite` has subscribers. If no subscriber adds a rejection handler to it, a storage write error causes an [`unhandledrejection` event](https://developer.mozilla.org/en-US/docs/Web/API/Window/unhandledrejection_event). If this event also has no handlers, or none of them call `event.preventDefault()`, the rejection is logged to the browser console.\n\n```javascript\n// Example\n\nwindow.addEventHandler(\"unhandledrejection\", (event) => {\n\tif (\"setItems\" in event.reason) {\n\t\tlet {error, setItems} = event.reason;\n\t\treportProblem(error);\n\t\tmarkUnsaved(Object.keys(setItems));\n\t}\n});\n```\n\n### Property: `unLive()`\n\n<i>No parameters</i>\n\nReverses the effects of the [`live: true` option](#live) so that the store group can be garbage-collected.\n\n```javascript\n// Example\n\n// In a Svelte component's <script> block\nimport webextStorageAdapter from \"svelte-webext-storage-adapter\";\nimport { onDestroy } from \"svelte\";\n\nvar { stores, ready, unLive } = webextStorageAdapter(\"sync\", \"myKey\");\nonDestroy( unLive );\n```\n\n### Methods don't use `this`\n\nThe `onWrite` and `unLive` methods of store groups don't use `this`, and may be freely assigned to other variables or properties without breaking their connection to their original store group.\n\n```javascript\n// Example\n\nvar stores = webextStorageAdapter(\"sync\", \"myKey\");\nvar { unLive } = stores;\n// These do the same thing\nstores.unLive();\nunLive();\n```\n\n## Implementation requirements for `StorageArea`\n\nAny object you pass in via the [`storageArea` parameter](#parameter-storagearea) will work if it implements the following interface:\n\n- [`get` method](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/storage/StorageArea/get)\n- [`set` method](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/storage/StorageArea/set)\n- [`onChanged` object](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/storage/StorageArea/onChanged) (only if [`live`](#live) is `true`)\n\t- `addListener` method\n\t- `removeListener` method (only if [`unLive`](#property-unlive) is used)\n\n`get` and `set` must accept callbacks; any returned Promise will not be used. They may indicate errors either by setting `chrome.runtime.lastError` (‚ö† but they need to delete it afterwards), or by passing an extra parameter to the callbacks.\n\n## Tip: Use with `svelte-writable-derived`\n\n<i>Full disclosure: I, Pixievolt, am the author of `svelte-writable-derived`. If you find this tip helpful, now you have </i>two<i> reasons to <a href=\"#-support-the-developer\">support me!</a></i>\n\nChrome's implementation of `chrome.storage` can't safely store anything besides booleans, numbers, strings, and arrays. If you need something more complex, you can use the [`svelte-writable-derived`](https://www.npmjs.com/package/svelte-writable-derived) package to translate your data to & from its storage-safe form.\n\n```javascript\nimport webextStorageAdapter from \"svelte-webext-storage-adapter\";\nimport writableDerived from \"svelte-writable-derived\";\n\nvar {stores, ready} = webextStorageAdapter({\n\t\"key\": `{\"storedAsJson\":true}`,\n})\nexportedStores = Object.assign({}, stores, {\n\t\"key\": writableDerived(\n\t\tstores.key,\n\t\t(json) => JSON.parse(json),\n\t\t(data) => JSON.stringify(data)\n\t),\n});\nexport { exportedStores as stores, ready, exportedStores as default };\n```\n\n## Browser compatibility\n\nThis package officially supports Firefox and Chrome. Other browsers that support WebExtensions aren't tested, but bug reports and pull requests for them are welcome. Firefox version 101+ and Chrome version 84+ support all additional requirements listed below.\n\nSupport for ECMAScript 2020 is required (see [caniuse data for optional chaining](https://caniuse.com/mdn-javascript_operators_optional_chaining)). Transpilers & polyfills are supported provided [`keys`](#parameter-keys) is not `null`.\n\nIf `keys` is `null`, support for [`WeakRef`](https://caniuse.com/mdn-javascript_builtins_weakref) is additionally required.\n\nIf [`live`](#live) is `true`, support for [`StorageArea.onChanged`](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/storage/StorageArea/onChanged#browser_compatibility) is additionally required. A polyfill may be used.\n\n# üíñ Support the developer\n\nI muchly appreciate any way you'd like to show your thanks - knowing people are helped gives me warm fuzzies and makes it all worthwhile!\n\n## üí∏ ... with money\n\nAt [my Ko-Fi page](https://ko-fi.com/pixievoltno1), you can make a one-time or monthly donation, or [commission work on an issue](https://ko-fi.com/pixievoltno1/commissions).\n\nYou can also support *all* your dependencies at once using [StackAid](https://www.stackaid.us/)!\n\n## üíå ... with kind words\n\nCurrent contact info is on [this page](https://pixievoltno1.com/contact/) - or you can create an \"issue\" on this repo just to say thanks! Thank-you \"issues\" will be closed right away, but are treasured regardless~\n\n## ü§ù ... with a job\n\nWant me to sling some JavaScript for you? [Look over my other work](https://github.com/PixievoltNo1) and [contact me!](https://pixievoltno1.com/contact/)",
	"legacy_svelte": false,
	"downloads_history": [
		[3596, 54],
		[3603, 31],
		[3610, 29],
		[3617, 30],
		[3624, 20],
		[3631, 37],
		[3638, 53],
		[3645, 39],
		[3652, 32],
		[3659, 36],
		[3666, 71],
		[3673, 43],
		[3680, 55],
		[3687, 42],
		[3694, 32],
		[3701, 52],
		[3708, 35],
		[3715, 45],
		[3722, 51],
		[3729, 40],
		[3736, 41],
		[3743, 109],
		[3750, 33],
		[3757, 32],
		[3764, 26],
		[3771, 22],
		[3778, 23],
		[3785, 12],
		[3792, 24],
		[3799, 15],
		[3806, 13],
		[3813, 7],
		[3820, 3],
		[3827, 6],
		[3834, 13],
		[3841, 30],
		[3848, 9],
		[3855, 28],
		[3862, 26],
		[3869, 6],
		[3876, 5],
		[3883, 14],
		[3890, 17],
		[3897, 6],
		[3904, 7],
		[3911, 11],
		[3918, 8],
		[3925, 6],
		[3932, 7],
		[3939, 6],
		[3946, 6],
		[3953, 5],
		[3960, 15],
		[3967, 20],
		[3974, 15],
		[3981, 2],
		[3988, 2],
		[3995, 6],
		[4002, 9],
		[4009, 9],
		[4016, 19],
		[4023, 7],
		[4030, 7],
		[4037, 12],
		[4044, 42],
		[4051, 13],
		[4058, 1],
		[4065, 26],
		[4072, 7],
		[4079, 9],
		[4086, 3],
		[4093, 6],
		[4100, 66],
		[4107, 2],
		[4114, 35],
		[4121, 13],
		[4128, 19],
		[4135, 20]
	]
}
