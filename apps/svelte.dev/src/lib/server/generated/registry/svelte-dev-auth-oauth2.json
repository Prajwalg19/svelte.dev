{
	"name": "@svelte-dev/auth-oauth2",
	"description": "Implement OAuth2 authentication strategies for Svelte apps.",
	"repo_url": "https://github.com/willin/svelte-turbo",
	"authors": ["willin"],
	"homepage": "https://svelte.js.cool",
	"downloads": 14,
	"updated": "2023-12-12T16:58:24.778Z",
	"tags": ["auth", "server"],
	"github_stars": 5,
	"typescript": true,
	"version": "1.0.2",
	"svelte_range": "^5.0.0-next.22",
	"kit_range": "^1.27.4",
	"last_rune_check_version": "1.0.2",
	"dependency_tree": {
		"rootIndex": 0,
		"packages": [
			{
				"name": "@svelte-dev/auth-oauth2",
				"version": "1.0.2",
				"size": 37264
			},
			{
				"name": "debug",
				"version": "4.4.0",
				"size": 42798
			},
			{
				"name": "ms",
				"version": "2.1.3",
				"size": 6721
			},
			{
				"name": "nanoid",
				"version": "5.1.5",
				"size": 12143
			}
		],
		"dependencies": [
			[0, 1],
			[1, 2],
			[0, 3]
		],
		"circular": []
	},
	"readme": "![Logo](https://repository-images.githubusercontent.com/726691357/f09bf6fc-3844-4584-8eee-6bfb425d8a38)\n\n# @svelte-dev/auth-oauth2 strategy\n\nA strategy to use and implement OAuth2 framework for authentication with federated services like Google, Facebook, GitHub, etc.\n\nFor more details: <https://github.com/willin/svelte-turbo>\n\n## Supported runtimes\n\n| Runtime    | Has Support |\n| ---------- | ----------- |\n| Node.js    | ✅          |\n| Cloudflare | ✅          |\n| Vercel     | ✅          |\n\n## How to use\n\n### Installation\n\n```bash\nnpm add @svelte-dev/auth-oauth2\n```\n\n### Directly\n\nYou can use this strategy by adding it to your authenticator instance and configuring the correct endpoints.\n\n```ts\nimport { Authenticator } from '@svelte-dev/auth';\nimport { OAuth2Strategy } from '@svelte-dev/auth-oauth2';\n\nexport const authenticator = new Authenticator<User>();\n\nauthenticator.use(\n  new OAuth2Strategy(\n    {\n      authorizationURL: 'https://provider.com/oauth2/authorize',\n      tokenURL: 'https://provider.com/oauth2/token',\n      clientID: process.env.CLIENT_ID,\n      clientSecret: process.env.CLIENT_SECRET,\n      callbackURL: 'https://example.app/auth/callback',\n      scope: 'openid email profile', // optional\n      useBasicAuthenticationHeader: false // defaults to false\n    },\n    async ({ accessToken, refreshToken, extraParams, profile, context, request }) => {\n      // here you can use the params above to get the user and return it\n      // what you do inside this and how you find the user is up to you\n      return await getUser(accessToken, refreshToken, extraParams, profile, context, request);\n    }\n  ),\n  // this is optional, but if you setup more than one OAuth2 instance you will\n  // need to set a custom name to each one\n  'provider-name'\n);\n```\n\n### Extending it\n\nYou can use this strategy as a base class for another strategy using the OAuth2 framework. That way, you wouldn't need to implement the whole OAuth2 flow yourself.\n\nThe `OAuth2Strategy` will handle the whole flow for you and let you replace parts of it where you need.\n\nLet's see how the `Auth0Strategy` is implemented using the `OAuth2Strategy` as a base.\n\n```ts\n// We need to import from Svelte Auth the type of the strategy verify callback\nimport type { StrategyVerifyCallback } from '@svelte-dev/auth';\n// We need to import the OAuth2Strategy, the verify params and the profile interfaces\nimport type { OAuth2Profile, OAuth2StrategyVerifyParams } from '@svelte-dev/auth-oauth2';\nimport { OAuth2Strategy } from '@svelte-dev/auth-oauth2';\n\n// These are the custom options we need from the developer to use the strategy\nexport interface Auth0StrategyOptions {\n  domain: string;\n  clientID: string;\n  clientSecret: string;\n  callbackURL: string;\n}\n\n// This interface declare what extra params we will get from Auth0 on the\n// verify callback\nexport interface Auth0ExtraParams extends Record<string, string | number> {\n  id_token: string;\n  scope: string;\n  expires_in: 86_400;\n  token_type: 'Bearer';\n}\n\n// The Auth0Profile extends the OAuth2Profile with the extra params and mark\n// some of them as required\nexport interface Auth0Profile extends OAuth2Profile {\n  id: string;\n  displayName: string;\n  name: {\n    familyName: string;\n    givenName: string;\n    middleName: string;\n  };\n  emails: Array<{ value: string }>;\n  photos: Array<{ value: string }>;\n  _json: {\n    sub: string;\n    name: string;\n    given_name: string;\n    family_name: string;\n    middle_name: string;\n    nickname: string;\n    preferred_username: string;\n    profile: string;\n    picture: string;\n    website: string;\n    email: string;\n    email_verified: boolean;\n    gender: string;\n    birthdate: string;\n    zoneinfo: string;\n    locale: string;\n    phone_number: string;\n    phone_number_verified: boolean;\n    address: {\n      country: string;\n    };\n    updated_at: string;\n  };\n}\n\n// And we create our strategy extending the OAuth2Strategy, we also need to\n// pass the User as we did on the FormStrategy, we pass the Auth0Profile and the\n// extra params\nexport class Auth0Strategy<User> extends OAuth2Strategy<User, Auth0Profile, Auth0ExtraParams> {\n  // The OAuth2Strategy already has a name but we override it to be specific of\n  // the service we are using\n  name = 'auth0';\n\n  private userInfoURL: string;\n\n  // We receive our custom options and our verify callback\n  constructor(\n    options: Auth0StrategyOptions,\n    // Here we type the verify callback as a StrategyVerifyCallback receiving\n    // the User type and the OAuth2StrategyVerifyParams with the Auth0Profile\n    // and the Auth0ExtraParams\n    // This way, when using the strategy the verify function will receive as\n    // params an object with accessToken, refreshToken, extraParams and profile.\n    // The latest two matching the types of Auth0Profile and Auth0ExtraParams.\n    verify: StrategyVerifyCallback<User, OAuth2StrategyVerifyParams<Auth0Profile, Auth0ExtraParams>>\n  ) {\n    // And we pass the options to the super constructor using our own options\n    // to generate them, this was we can ask less configuration to the developer\n    // using our strategy\n    super(\n      {\n        authorizationURL: `https://${options.domain}/authorize`,\n        tokenURL: `https://${options.domain}/oauth/token`,\n        clientID: options.clientID,\n        clientSecret: options.clientSecret,\n        callbackURL: options.callbackURL\n      },\n      verify\n    );\n\n    this.userInfoURL = `https://${options.domain}/userinfo`;\n    this.scope = options.scope || 'openid profile email';\n    this.audience = options.audience;\n  }\n\n  // We override the protected authorizationParams method to return a new\n  // URLSearchParams with custom params we want to send to the authorizationURL.\n  // Here we add the scope so Auth0 can use it, you can pass any extra param\n  // you need to send to the authorizationURL here base on your provider.\n  protected authorizationParams() {\n    const urlSearchParams: Record<string, string> = {\n      scope: this.scope\n    };\n\n    if (this.audience) {\n      urlSearchParams.audience = this.audience;\n    }\n\n    return new URLSearchParams(urlSearchParams);\n  }\n\n  // We also override how to use the accessToken to get the profile of the user.\n  // Here we fetch a Auth0 specific URL, get the profile data, and build the\n  // object based on the Auth0Profile interface.\n  protected async userProfile(accessToken: string): Promise<Auth0Profile> {\n    let response = await fetch(this.userInfoURL, {\n      headers: { Authorization: `Bearer ${accessToken}` }\n    });\n\n    let data: Auth0Profile['_json'] = await response.json();\n\n    let profile: Auth0Profile = {\n      provider: 'auth0',\n      displayName: data.name,\n      id: data.sub,\n      name: {\n        familyName: data.family_name,\n        givenName: data.given_name,\n        middleName: data.middle_name\n      },\n      emails: [{ value: data.email }],\n      photos: [{ value: data.picture }],\n      _json: data\n    };\n\n    return profile;\n  }\n}\n```\n\nAnd that's it, thanks to the `OAuth2Strategy` we don't need to implement the whole OAuth2 flow ourselves and can focus on the unique parts of our strategy which is the user profile and extra params our provider may require us to send.\n\n## 赞助 Sponsor\n\n维护者 Owner： [Willin Wang](https://willin.wang)\n\n如果您对本项目感兴趣，可以通过以下方式支持我：\n\n- 关注我的 Github 账号：[@willin](https://github.com/willin) [![github](https://img.shields.io/github/followers/willin.svg?style=social&label=Followers)](https://github.com/willin)\n- 参与 [爱发电](https://afdian.net/@willin) 计划\n- 支付宝或微信[扫码打赏](https://user-images.githubusercontent.com/1890238/89126156-0f3eeb80-d516-11ea-9046-5a3a5d59b86b.png)\n\nDonation ways:\n\n- Github: <https://github.com/sponsors/willin>\n- Paypal: <https://paypal.me/willinwang>\n- Alipay or Wechat Pay: [QRCode](https://user-images.githubusercontent.com/1890238/89126156-0f3eeb80-d516-11ea-9046-5a3a5d59b86b.png)\n\n## 许可证 License\n\nApache-2.0\n",
	"legacy_svelte": false,
	"downloads_history": [
		[3617, 58],
		[3624, 608],
		[3631, 76],
		[3638, 21],
		[3645, 27],
		[3652, 7],
		[3659, 14],
		[3666, 26],
		[3673, 6],
		[3680, 3],
		[3687, 3],
		[3694, 20],
		[3701, 3],
		[3708, 2],
		[3715, 6],
		[3722, 11],
		[3729, 8],
		[3736, 4],
		[3743, 1],
		[3750, 10],
		[3757, 6],
		[3764, 1],
		[3771, 5],
		[3778, 9],
		[3785, 2],
		[3792, 1],
		[3799, 1],
		[3806, 4],
		[3813, 1],
		[3820, 4],
		[3827, 3],
		[3834, 46],
		[3841, 2],
		[3848, 1],
		[3855, 9],
		[3862, 20],
		[3869, 4],
		[3876, 6],
		[3883, 3],
		[3890, 4],
		[3897, 2],
		[3904, 13],
		[3911, 5],
		[3918, 3],
		[3925, 3],
		[3932, 2],
		[3939, 2],
		[3946, 1],
		[3953, 3],
		[3967, 9],
		[3981, 1],
		[3988, 4],
		[3995, 2],
		[4002, 1],
		[4009, 2],
		[4016, 3],
		[4030, 2],
		[4037, 17],
		[4044, 13],
		[4051, 1],
		[4058, 1],
		[4072, 1],
		[4093, 10],
		[4100, 18],
		[4107, 13],
		[4114, 14],
		[4121, 9],
		[4128, 4]
	],
	"esm": true,
	"cjs": false
}
