{
	"name": "sveltekit-adapter-iis",
	"description": "SvelteKit adapter for IIS web servers.",
	"repo_url": "https://github.com/abaga129/sveltekit-adapter-iis",
	"authors": ["abaga129"],
	"downloads": 47,
	"updated": "2024-11-06T20:19:37.060Z",
	"tags": ["adapter"],
	"github_stars": 19,
	"homepage": null,
	"typescript": true,
	"version": "1.4.1",
	"svelte_range": "^4.2.8",
	"kit_range": "^2.0.4",
	"last_rune_check_version": "1.4.1",
	"dependency_tree": {
		"rootIndex": 0,
		"packages": [
			{
				"name": "sveltekit-adapter-iis",
				"version": "1.4.1",
				"size": 141109
			},
			{
				"name": "@sveltejs/adapter-node",
				"version": "2.1.2",
				"size": 49274
			},
			{
				"name": "rollup",
				"version": "4.40.1",
				"size": 2727114
			},
			{
				"name": "@types/estree",
				"version": "1.0.7",
				"size": 26147
			},
			{
				"name": "@rollup/plugin-json",
				"version": "6.1.0",
				"size": 10683
			},
			{
				"name": "@rollup/pluginutils",
				"version": "5.1.4",
				"size": 58354
			},
			{
				"name": "estree-walker",
				"version": "2.0.2",
				"size": 50243
			},
			{
				"name": "picomatch",
				"version": "4.0.2",
				"size": 85237
			},
			{
				"name": "@rollup/plugin-commonjs",
				"version": "25.0.8",
				"size": 258175
			},
			{
				"name": "glob",
				"version": "8.1.0",
				"size": 56156
			},
			{
				"name": "once",
				"version": "1.4.0"
			},
			{
				"name": "wrappy",
				"version": "1.0.2"
			},
			{
				"name": "inflight",
				"version": "1.0.6"
			},
			{
				"name": "inherits",
				"version": "2.0.4",
				"size": 3958
			},
			{
				"name": "minimatch",
				"version": "5.1.6",
				"size": 38919
			},
			{
				"name": "brace-expansion",
				"version": "2.0.1",
				"size": 11486
			},
			{
				"name": "balanced-match",
				"version": "1.0.2",
				"size": 6939
			},
			{
				"name": "fs.realpath",
				"version": "1.0.0"
			},
			{
				"name": "commondir",
				"version": "1.0.1"
			},
			{
				"name": "is-reference",
				"version": "1.2.1",
				"size": 6374
			},
			{
				"name": "magic-string",
				"version": "0.30.17",
				"size": 467464
			},
			{
				"name": "@jridgewell/sourcemap-codec",
				"version": "1.5.0",
				"size": 112815
			},
			{
				"name": "@rollup/plugin-node-resolve",
				"version": "15.3.1",
				"size": 154449
			},
			{
				"name": "resolve",
				"version": "1.22.10",
				"size": 145619
			},
			{
				"name": "is-core-module",
				"version": "2.16.1",
				"size": 33475
			},
			{
				"name": "hasown",
				"version": "2.0.2",
				"size": 8765
			},
			{
				"name": "function-bind",
				"version": "1.1.2",
				"size": 31427
			},
			{
				"name": "path-parse",
				"version": "1.0.7",
				"size": 4511
			},
			{
				"name": "supports-preserve-symlinks-flag",
				"version": "1.0.0",
				"size": 9178
			},
			{
				"name": "deepmerge",
				"version": "4.3.1",
				"size": 31157
			},
			{
				"name": "is-module",
				"version": "1.0.0"
			},
			{
				"name": "@types/resolve",
				"version": "1.20.2",
				"size": 9885
			},
			{
				"name": "detect-package-manager",
				"version": "3.0.2",
				"size": 10500
			},
			{
				"name": "execa",
				"version": "5.1.1",
				"size": 57525
			},
			{
				"name": "onetime",
				"version": "5.1.2",
				"size": 6173
			},
			{
				"name": "mimic-fn",
				"version": "2.1.0",
				"size": 4457
			},
			{
				"name": "is-stream",
				"version": "2.0.1",
				"size": 5927
			},
			{
				"name": "get-stream",
				"version": "6.0.1",
				"size": 12176
			},
			{
				"name": "cross-spawn",
				"version": "7.0.6",
				"size": 16094
			},
			{
				"name": "which",
				"version": "2.0.2",
				"size": 9975
			},
			{
				"name": "isexe",
				"version": "2.0.0"
			},
			{
				"name": "path-key",
				"version": "3.1.1",
				"size": 4553
			},
			{
				"name": "shebang-command",
				"version": "2.0.0",
				"size": 2556
			},
			{
				"name": "shebang-regex",
				"version": "3.0.0",
				"size": 2828
			},
			{
				"name": "signal-exit",
				"version": "3.0.7",
				"size": 9958
			},
			{
				"name": "merge-stream",
				"version": "2.0.0",
				"size": 4306
			},
			{
				"name": "npm-run-path",
				"version": "4.0.1",
				"size": 8128
			},
			{
				"name": "human-signals",
				"version": "2.1.0",
				"size": 44307
			},
			{
				"name": "strip-final-newline",
				"version": "2.0.0",
				"size": 3046
			},
			{
				"name": "dotenv",
				"version": "16.5.0",
				"size": 75565
			},
			{
				"name": "fs-extra",
				"version": "11.3.0",
				"size": 55287
			},
			{
				"name": "graceful-fs",
				"version": "4.2.11",
				"size": 32535
			},
			{
				"name": "jsonfile",
				"version": "6.1.0",
				"size": 19750
			},
			{
				"name": "universalify",
				"version": "2.0.1",
				"size": 4675
			}
		],
		"dependencies": [
			[0, 1],
			[1, 2],
			[2, 3],
			[1, 4],
			[4, 5],
			[5, 3],
			[5, 6],
			[5, 7],
			[1, 8],
			[8, 9],
			[9, 10],
			[10, 11],
			[9, 12],
			[12, 10],
			[12, 11],
			[9, 13],
			[9, 14],
			[14, 15],
			[15, 16],
			[9, 17],
			[8, 18],
			[8, 19],
			[19, 3],
			[8, 20],
			[20, 21],
			[8, 6],
			[8, 5],
			[1, 22],
			[22, 23],
			[23, 24],
			[24, 25],
			[25, 26],
			[23, 27],
			[23, 28],
			[22, 29],
			[22, 30],
			[22, 31],
			[22, 5],
			[0, 32],
			[32, 33],
			[33, 34],
			[34, 35],
			[33, 36],
			[33, 37],
			[33, 38],
			[38, 39],
			[39, 40],
			[38, 41],
			[38, 42],
			[42, 43],
			[33, 44],
			[33, 45],
			[33, 46],
			[46, 41],
			[33, 47],
			[33, 48],
			[0, 49],
			[0, 50],
			[50, 51],
			[50, 52],
			[52, 53],
			[50, 53]
		],
		"circular": []
	},
	"readme": "# SvelteKit Adapter IIS\n\n[![Svelte](https://img.shields.io/badge/svelte-%23f1413d.svg?style=for-the-badge&logo=svelte&logoColor=white)](https://sveltesociety.dev/packages?category=sveltekit-adapters) [![NPM](https://img.shields.io/badge/NPM-%23CB3837.svg?style=for-the-badge&logo=npm&logoColor=white)](https://www.npmjs.com/package/sveltekit-adapter-iis) ![PNPM](https://img.shields.io/badge/pnpm-%234a4a4a.svg?style=for-the-badge&logo=pnpm&logoColor=f69220)\n\nThis package contains an adapter for Sveltekit that will make your project output deployable to IIS.\n\n## Usage\n\n1. Install to your sveltekit project\n\n### From npm\n\n```bash\npnpm add -D sveltekit-adapter-iis\n#or\nnpm i sveltekit-adapter-iis --save-dev\n#or\nyarn add sveltekit-adapter-iis --dev\n```\n\n2. In your `svelte.config.js` file replace default adapter with `IISAdapter`\n\n```js\nimport { vitePreprocess } from '@sveltejs/kit/vite'\nimport IISAdapter from 'sveltekit-adapter-iis'\n\n/** @type {import('@sveltejs/kit').Config} */\nconst config = {\n  preprocess: vitePreprocess(),\n\n  kit: {\n    version: {\n      pollInterval: 300000,\n    },\n    adapter: IISAdapter({\n      // the hostname/port that the site will be hosted on in IIS.\n      // can be changed later in web.config\n      origin: 'http://localhost:80XX',\n      // ... other options\n    }),\n  },\n}\n\nexport default config\n```\n\n3. Build the project\n\n```sh\npnpm build\n#or\nnpm run build\n```\n\n4. Install dependencies\n\nYou should try to bundle all your dependencies as dev dependencies so that you can skip this step however not all dependencies play nice. In this case you can install just the production dependencies using your preferred package manager.\n\nnpm\n\n```\nnpm install --omit-dev\n```\n\npnpm\n\n```bash\npnpm install --P\n```\n\nyarn\n\n```bash\nyarn install --production=true\n```\n\nbun\n\n```bash\nbun install --production\n```\n\n## Deploy the files to IIS\n\n### Prerequisites\n\n- IIS 7.0 or greater with `IISRewrite` module and [iisnode](\"https://github.com/Azure/iisnode\") installed\n- Check out [Setting up IIS](#setting-up-iis) or [IIS Troubleshooting](#iis-troubleshooting) if needed.\n\n### Option 1: Direct point to output directory\n\n- This is useful for local testing with IIS running on your machine\n- You will have to stop the website and possibly IIS every time when re-building.\n\n1 . In IIS Manager add a new Website: `Sites -> Add Website...`  \n2. Set the `Physical Path` to `<your project>/.svelte-kit/adapter-iis`.\n\n### Option 2: Copying build output elsewhere\n\n1. create a new folder in `C:/inetpub/<your project>`\n2. copy the contents of `<your project>/.svelte-kit/adapter-iis` into `C:/inetpub/<your project>`\n3. In IIS Manager add a new Website: `Sites -> Add Website...`\n4. Set the `Physical Path` to `C:/inetpub/<your project>`.\n\n## Setting up IIS\n\nThis is not a complete guide, but it should help.\n\n1. [Enable IIS on your local machine for testing](https://www.howtogeek.com/112455/how-to-install-iis-8-on-windows-8/)\n2. Restart your computer, check if it works by going to `localhost` without a port\n3. Find the IIS manager program (recommended: pin it to start)\n   - `C:\\ProgramData\\Microsoft\\Windows\\Start Menu\\Programs\\Administrative Tools`\n     - `Internet Information Services (IIS) Manager`\n   - or: `%windir%\\system32\\inetsrv\\InetMgr.exe`\n4. Install [URL Rewrite](https://www.iis.net/downloads/microsoft/url-rewrite#additionalDownloads) and [iisnode](https://github.com/Azure/iisnode/releases) modules\n   - URLRewrite: `English x64`\n   - iisnode: `iisnode-full-vx.x.x-x64.msi`\n5. Restart IIS from the manager:\n   ![iismanager restart](.github/assets/IISmgr1.png)\n6. Unlock the section in global config (More information needed)\n7. Set some permission to `Read/Write` instead of `Read Only` (More information needed)\n8. Set up logs:\n   - Set `iisNodeOptions.loggingEnabled` to `true` in the adapter options\n   - (Optional) Configure a path for the logs using `iisNodeOptions.logDirectory`\n\n## IIS troubleshooting\n\n- [Locked section error](https://serverfault.com/a/516921)\n- **URLs are not being handled by sveltekit**\n  - UrlRewrite rule might not be enabled\n- **Node executable cannot be found**\n  - By default the nodeExePath is set to `node.exe` to override this set `iisNodeOptions.overrideNodeExePath`.\n  ```js\n  const config = {\n    //...\n    kit: {\n      adapter: IISAdapter({\n        iisNodeOptions: {\n          nodeProcessCommandLine: 'C:\\\\Program Files\\\\nodejs\\\\node.exe', // or whatever the path is\n        },\n      }),\n    },\n  }\n  ```\n- **Logs not being written, builds fail if server is running with `EBUSY` fs error.**\n  - Set up file permissions for log dir & for `adapter-iis` dir for IIS_USER or Everyone to allow all\n  - If they are still not being written, instead of `console.log`, try using `console.warn` - it will show up in `stderr` logs without stopping the server.\n  - IIS likes to often overwrite log files instead of creating new ones, so make sure you open+close your text editor to see the latest log contents.\n- **Images or scripts outside of sveltekit (e.g. Virtual Directories, or external) fail to load**\n  - If you are using a full url with `https://` protocol, and have not set up SSL certificates in IIS, it will fail due to 'Cannot provide secure connection'\n    - If the url's on the same origin, try using a relative URL\n      - example: `/virtual-images/image1.png` instead of `https://localhost:XXXX/virtual-images/image1.png`\n    - If the url's on a different origin, try changing it to `http` instead of `https`\n      - If you're generating the url, on the URL object, you can change the `protocol` key\n      - make sure to build it with `https` once deploying to production\n  - You _could_ also probably set the site to use https in IIS, in site settings.\n- **POST requests or form actions fail with error 403**\n  - Either you forgot to specify the `origin` option, or it is mismatched\n  - Set it like this:\n  ```js\n  // svelte.config.js\n  const config = {\n    //...\n    kit: {\n      adapter: IISAdapter({\n        origin: 'http://localhost:8010', // or whatever the site's origin is when you deploy it using IIS\n      }),\n    },\n  }\n  ```\n  This sets it in `web.config` during building.\n- **Only seeing default Error Page when accessing the app remotely**\n  - You need to enable `Detailed errors` in IIS for the site.\n  - Navigate to the site in IIS Manager\n  - Open `Error Pages`\n  - Click `Edit Feature Settings...` under the Actions menu on the right\n  - Change Error Responses to `Detailed Errors`. \n  This will allow Sveltekit to handle errors itself.\n![image](https://github.com/user-attachments/assets/af03211f-32e2-4636-82c2-22264fac6588)\n\n\n## `outputWhitelist`\n\nThis adapter also provides `outputWhitelist` in options. This is useful when you need some extra directories on server for the app to function. You can do the following:\n\nUse `rollup-plugin-copy` to copy the files\n\n```ts\n// vite.config.ts\nimport { resolve } from 'node:path'\nimport { defineConfig, normalizePath } from 'vite'\nimport copy from 'rollup-plugin-copy'\n\n// your define config does not need to be a function, i think\n// i did it like this to make sure thecopy plugin only runs when building\nexport default defineConfig(({ command }) => {\n  const config = {\n    // ...\n    plugins: [],\n  }\n  if (command === 'build') {\n    const copyPlugin = copy({\n      targets: [\n        {\n          // some files you want to copy over\n          src: [\n            'db/*.htaccess',\n            'db/schema.json',\n            'db/*SCINDEX.json',\n            'db/vtmeta.yml',\n          ],\n          dest: normalizePath(resolve('.svelte-kit', 'adapter-iis', 'db')),\n        },\n      ],\n      hook: 'writeBundle',\n    })\n\n    config.plugins.push(copyPlugin)\n  }\n  return config\n})\n```\n\nset the `outputWhitelist`\n\n```js\n// svelte.config.js\nconst config = {\n  //...\n  kit: {\n    adapter: IISAdapter({\n      // origin, ...\n      outputWhitelist: ['db'],\n    }),\n  },\n}\n```\n\nNow, when building, `.svelte-kit/adapter-iis/db` should get preserved instead of being deleted\n\n## Using Virtual Directories\n\nYou might want to use the IIS feature 'Virtual Directory', where it maps a real directory onto a route.\nTo make sure sveltekit doesn't block this with a 404, modify `externalRoutes` option in the adapter config:\n\n```js\n// svelte.config.js\nconst config = {\n  //...\n  kit: {\n    adapter: IISAdapter({\n      // origin, ...\n      externalRoutes: ['cdn', 'images', 'viewer'],\n    }),\n  },\n}\n```\n\nThen add some virtual directories that map to `cdn`, `images`, and `viewer`.\nRe-build the app, and these routes will be taken into account in the generated `web.config` file.\n\n## `/healthcheck` route\n\nBy default, since IIS can be quite tricky to set up, the adapter adds a simple `/healthcheck` route, which responds with 'ok'\nThis is useful if you want to determine that the node server is running, but your main site isn't loading for whatever reson.\nThe route can be turned off setting the `healthcheckRoute` adapter option to `false`. (A re-build is needed to take effect.)\n\n## Handling stage specific environment variables\n\nWhen providing environment variables through a `.env` file, the adapter will also look for any `.env.{stage}` files in order to create `web.{stage}.config` transformation files in `.svelte-kit/adapter-iis`. These transformation files can later be used to perform XML Transformation steps in your CI/CD pipelines based on which stage is being deployed to.\n\nRead more about XML Transformations here: [XML Transformation in Azure Pipelines](https://learn.microsoft.com/en-us/azure/devops/pipelines/tasks/transforms-variable-substitution?view=azure-devops&tabs=Classic#xml-transformation)\n\n## Redirecting requests to HTTPS\n\n```js\n// svelte.config.js\nconst config = {\n  //...\n  kit: {\n    adapter: IISAdapter({\n      // origin, ...\n      redirectToHttps: true,\n    }),\n  },\n}\n```\n\nBy setting the option `redirectToHttps` to `true`, a URL Rewrite rule is applied to the `web.config` file that redirect all non-HTTPS request to HTTPS.\n\n## `httpErrors`\n\nBy default IIS will take control of HTTP errors and show the default IIS `[STATUS].htm` for each status. If you want the SvelteKit application to handle all HTTP errors, you can specify `httpErrors.existingResponse` with `PassThrough` to let the application handle the errors.\n\n```js\n// svelte.config.js\nconst config = {\n  //...\n  kit: {\n    adapter: IISAdapter({\n      // origin, ...\n      httpErrors: {\n        existingResponse: 'PassThrough',\n      },\n    }),\n  },\n}\n```\n\n## Disclaimer\n\nNote that this only works when served from the root of a domain.\n\nSo you can serve it from `www.mysvelteapp.com` or `sub.mysvelteapp.com` but it will not work from `www.mysvelteapp.com/subfolder`. Unfortunately this is due to how routing works with sveltekit. Adding the `base` property to your sveltekit config causes all of the routes to have that appended so you end up with the app living on `www.mysevelteapp.com/subfolder/subfolder`.\n\n## How it works\n\nThis adapter wraps `adapter-node` from `@sveltejs/kit` and uses `node:http` as the web server. It outputs a web.config file that rewrites incoming requests to the `node:http` server.\n\n## Contributions\n\nContributions are welcome! Please open an issue or submit a PR if you would like to help out with this project!\n",
	"legacy_svelte": false,
	"downloads_history": [
		[3596, 67],
		[3603, 38],
		[3610, 29],
		[3617, 16],
		[3624, 20],
		[3631, 6],
		[3638, 24],
		[3645, 12],
		[3652, 26],
		[3659, 229],
		[3666, 88],
		[3673, 249],
		[3680, 210],
		[3687, 126],
		[3694, 45],
		[3701, 161],
		[3708, 75],
		[3715, 78],
		[3722, 45],
		[3729, 54],
		[3736, 34],
		[3743, 65],
		[3750, 97],
		[3757, 79],
		[3764, 44],
		[3771, 181],
		[3778, 114],
		[3785, 53],
		[3792, 91],
		[3799, 44],
		[3806, 67],
		[3813, 67],
		[3820, 69],
		[3827, 151],
		[3834, 106],
		[3841, 135],
		[3848, 51],
		[3855, 20],
		[3862, 46],
		[3869, 85],
		[3876, 22],
		[3883, 117],
		[3890, 75],
		[3897, 70],
		[3904, 108],
		[3911, 41],
		[3918, 53],
		[3925, 32],
		[3932, 58],
		[3939, 40],
		[3946, 67],
		[3953, 187],
		[3960, 176],
		[3967, 66],
		[3974, 75],
		[3981, 97],
		[3988, 55],
		[3995, 71],
		[4002, 42],
		[4009, 15],
		[4016, 153],
		[4023, 78],
		[4030, 51],
		[4037, 58],
		[4044, 52],
		[4051, 44],
		[4058, 41],
		[4065, 48],
		[4072, 31],
		[4079, 31],
		[4086, 77],
		[4093, 39],
		[4100, 57],
		[4107, 78],
		[4114, 47],
		[4121, 52],
		[4128, 41],
		[4135, 45]
	],
	"esm": true,
	"cjs": false
}
